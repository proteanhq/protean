
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://docs.proteanhq.com/patterns/testing-domain-logic-in-isolation/">
      
      
        <link rel="prev" href="../thin-handlers-rich-domain/">
      
      
        <link rel="next" href="../creating-identities-early/">
      
      
        
      
      
      <link rel="icon" href="../../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.2">
    
    
      
        <title>Testing Domain Logic in Isolation - Protean</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        
        <link rel="stylesheet" href="../../assets/external/fonts.googleapis.com/css.56f7ac64.css">
        <style>:root{--md-text-font:"Inter";--md-code-font:"JetBrains Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="teal">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#testing-domain-logic-in-isolation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Protean" class="md-header__button md-logo" aria-label="Protean" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Protean
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Testing Domain Logic in Isolation
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="teal"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="teal"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/proteanhq/protean" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    proteanhq/protean
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../.." class="md-tabs__link">
          
  
  
    
  
  Protean

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../guides/getting-started/installation/" class="md-tabs__link">
          
  
  
    
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../guides/" class="md-tabs__link">
          
  
  
    
  
  Guides

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../reference/" class="md-tabs__link">
          
  
  
    
  
  Reference

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../concepts/" class="md-tabs__link">
          
  
  
    
  
  Concepts

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  
    
  
  Patterns & Recipes

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../glossary/" class="md-tabs__link">
        
  
  
    
  
  Glossary

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../community/" class="md-tabs__link">
          
  
  
    
  
  Community

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Protean" class="md-nav__button md-logo" aria-label="Protean" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    Protean
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/proteanhq/protean" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    proteanhq/protean
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../.." class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Protean
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1" id="__nav_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Protean
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../start-here/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Start Here
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/philosophy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Philosophy &amp; Design Principles
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Contents
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../how-do-i/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    How Do I...?
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Getting Started
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/getting-started/installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/getting-started/quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quickstart
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../guides/getting-started/tutorial/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Tutorial
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Tutorial
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_3_2" >
        
          
          <label class="md-nav__link" for="__nav_2_3_2" id="__nav_2_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Part I - Building the Domain
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Part I - Building the Domain
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/getting-started/tutorial/01-your-first-aggregate/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    1. Your First Aggregate
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/getting-started/tutorial/02-fields-and-value-objects/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2. Rich Fields and Value Objects
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/getting-started/tutorial/03-entities-and-associations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    3. Entities and Associations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/getting-started/tutorial/04-business-rules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    4. Business Rules
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_3_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3_3" id="__nav_2_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Part II - Making It Event-Driven
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Part II - Making It Event-Driven
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/getting-started/tutorial/05-commands/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    5. Commands and Handlers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/getting-started/tutorial/06-events-and-reactions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    6. Events and Reactions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_3_4" >
        
          
          <label class="md-nav__link" for="__nav_2_3_4" id="__nav_2_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Part III - Read Models and Persistence
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Part III - Read Models and Persistence
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/getting-started/tutorial/07-projections/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    7. Projections
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/getting-started/tutorial/08-persistence/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    8. Connecting a Real Database
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_3_5" >
        
          
          <label class="md-nav__link" for="__nav_2_3_5" id="__nav_2_3_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Part IV - Testing
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Part IV - Testing
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/getting-started/tutorial/09-testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    9. Testing Your Domain
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/getting-started/tutorial/10-whats-next/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    10. What Comes Next
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../guides/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Guides
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Guides
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../guides/pathways/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Choose a Path
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Choose a Path
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/pathways/ddd/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Domain-Driven Design with Protean
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/pathways/cqrs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CQRS with Protean
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/pathways/event-sourcing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Event Sourcing with Protean
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../guides/compose-a-domain/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Set Up the Domain
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Set Up the Domain
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/compose-a-domain/register-elements/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Register elements
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/compose-a-domain/initialize-domain/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Initialize the domain
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/compose-a-domain/activate-domain/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Activate the domain
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/compose-a-domain/when-to-compose/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    When to compose
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../guides/domain-definition/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Model Your Domain
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Model Your Domain
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/domain-definition/aggregates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Aggregates
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/domain-definition/entities/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Entities
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/domain-definition/value-objects/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Value Objects
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/domain-definition/relationships/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Expressing Relationships
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/domain-definition/events/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Events
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/domain-definition/deciding-between-elements/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Deciding Between Elements
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../guides/domain-behavior/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Add Rules and Behavior
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Add Rules and Behavior
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/domain-behavior/validations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Basic Validations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/domain-behavior/invariants/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Invariants
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/domain-behavior/aggregate-mutation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Mutating Aggregates
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/domain-behavior/raising-events/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Raising Events
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/domain-behavior/domain-services/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Domain Services
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../guides/change-state/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Change State
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Change State
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/change-state/application-services/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Application Services
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/change-state/commands/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Commands
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/change-state/command-handlers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Command Handlers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/change-state/repositories/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Repositories
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/change-state/persist-aggregates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Persist Aggregates
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/change-state/retrieve-aggregates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Retrieve Aggregates
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/change-state/temporal-queries/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Temporal Queries
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/change-state/unit-of-work/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Unit of Work
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../guides/consume-state/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    React to Changes
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_7" id="__nav_3_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    React to Changes
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/consume-state/event-handlers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Event Handlers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/consume-state/process-managers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Process Managers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/consume-state/projections/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Managing Projections
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/consume-state/subscribers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Subscribers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/consume-state/event-upcasting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Event Upcasting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_8" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../guides/fastapi/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Expose Your Domain
  

    
  </span>
  
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Expose Your Domain
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_9" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../guides/server/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Run the Server
  

    
  </span>
  
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    Run the Server
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_10" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../guides/testing/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Test Your Application
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_10" id="__nav_3_10_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    Test Your Application
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/testing/domain-model-tests/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Domain Model Tests
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/testing/application-tests/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Application Tests
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/testing/event-sourcing-tests/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Event Sourcing Tests
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/testing/integration-tests/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Integration Tests
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/testing/fixtures-and-patterns/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Fixtures and Patterns
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Reference
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/domain-elements/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Domain Elements
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Domain Elements
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/domain-elements/element-decorators/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Decorators
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/domain-elements/object-model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Object Model
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/domain-elements/identity/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Identity
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/fields/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Fields
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Fields
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/fields/defining-fields/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Defining fields
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/fields/simple-fields/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Simple Fields
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/fields/container-fields/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Container Fields
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/fields/association-fields/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Association Fields
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/fields/arguments/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Common Arguments
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/configuration/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Configuration
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/cli/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    CLI
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    CLI
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_5_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/cli/project/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Project
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_5_2" id="__nav_4_5_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Project
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/cli/project/new/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    protean new
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/cli/project/discovery/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Domain Discovery
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/cli/project/shell/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    protean shell
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/cli/project/docs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    protean docs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_5_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/cli/runtime/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Runtime
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_5_3" id="__nav_4_5_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Runtime
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/cli/runtime/server/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    protean server
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/cli/runtime/observatory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    protean observatory
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_5_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/cli/data/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Data
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_5_4" id="__nav_4_5_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Data
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/cli/data/database/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    protean db
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/cli/data/events/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    protean events
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/cli/data/snapshot/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    protean snapshot
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/cli/data/projection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    protean projection
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/server/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Server
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_6" id="__nav_4_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Server
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/server/subscription-types/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Subscription Types
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/server/configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Subscription Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/server/supervisor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Multi-Worker Mode
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/server/observability/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Observability
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/adapters/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Adapters
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_7" id="__nav_4_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Adapters
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_7_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/adapters/database/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Database
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_7_2" id="__nav_4_7_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_7_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Database
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/adapters/database/postgresql/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    PostgreSQL
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/adapters/database/elasticsearch/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Elasticsearch
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_7_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/adapters/broker/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Brokers
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_7_3" id="__nav_4_7_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_7_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_7_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Brokers
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/adapters/broker/inline/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Inline Broker
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/adapters/broker/redis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Redis Stream Broker
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/adapters/broker/redis-pubsub/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Redis PubSub Broker
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/adapters/broker/custom-brokers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Custom Brokers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_7_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/adapters/cache/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Caches
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_7_4" id="__nav_4_7_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_7_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_7_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Caches
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/adapters/cache/redis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Redis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_7_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/adapters/eventstore/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Event Stores
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_7_5" id="__nav_4_7_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_7_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_7_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Event Stores
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/adapters/eventstore/message-db/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Message DB
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_8" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/type-checking/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Type Checking
  

    
  </span>
  
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Type Checking
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_9" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/testing/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Testing
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_9" id="__nav_4_9_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    Testing
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/testing/pytest-plugin/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Pytest Plugin
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_10" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/migration/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Migration
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_10" id="__nav_4_10_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    Migration
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/migration/v0-15/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Migrating to 0.15
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../concepts/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Concepts
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Concepts
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../concepts/philosophy/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Philosophy & Principles
  

    
  </span>
  
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Philosophy & Principles
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../concepts/foundations/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Foundations
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Foundations
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/foundations/ubiquitous-language/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Ubiquitous Language
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/foundations/bounded-contexts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Bounded Contexts
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/foundations/analysis-model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Analysis Model
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/foundations/identity/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Identity
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/foundations/invariants/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Invariants
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/foundations/changing-state/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Changing State
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/foundations/streams/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Streams
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../concepts/architecture/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Architecture Patterns
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Architecture Patterns
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/architecture/ddd/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DDD
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/architecture/cqrs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CQRS
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/architecture/event-sourcing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Event Sourcing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/architecture/architecture-decision/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Choosing Between Patterns
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../concepts/building-blocks/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Building Blocks
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_5" id="__nav_5_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Building Blocks
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/building-blocks/aggregates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Aggregates
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/building-blocks/entities/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Entities
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/building-blocks/value-objects/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Value Objects
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/building-blocks/domain-services/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Domain Services
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/building-blocks/events/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Events
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/building-blocks/commands/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Commands
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/building-blocks/command-handlers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Command Handlers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/building-blocks/event-handlers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Event Handlers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/building-blocks/application-services/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Application Services
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/building-blocks/repositories/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Repositories
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/building-blocks/subscribers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Subscribers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/building-blocks/projections/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Projections
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/building-blocks/projectors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Projectors
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/building-blocks/process-managers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Process Managers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../concepts/async-processing/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Async Processing
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_6" id="__nav_5_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Async Processing
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/async-processing/engine/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Engine Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/async-processing/subscriptions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Subscriptions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/async-processing/outbox/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Outbox Pattern
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/async-processing/priority-lanes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Priority Lanes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/async-processing/stream-categories/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Stream Categories
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../concepts/ports-and-adapters/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Ports & Adapters
  

    
  </span>
  
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Ports & Adapters
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_8" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../concepts/internals/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Internals
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_8" id="__nav_5_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Internals
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/internals/field-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Field system
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/internals/shadow-fields/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Shadow fields
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/internals/query-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Query system
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/internals/event-sourcing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Event Sourcing Internals
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/internals/event-upcasting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Event Upcasting Internals
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Patterns & Recipes
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6" id="__nav_6_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Patterns & Recipes
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_2" >
        
          
          <label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Aggregate Design
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Aggregate Design
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../design-small-aggregates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Design Small Aggregates
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../one-aggregate-per-transaction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    One Aggregate Per Transaction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../encapsulate-state-changes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Encapsulate State Changes in Named Methods
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../replace-primitives-with-value-objects/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Replace Primitives with Value Objects
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_3" >
        
          
          <label class="md-nav__link" for="__nav_6_3" id="__nav_6_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Event-Driven Patterns
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Event-Driven Patterns
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../design-events-for-consumers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Design Events for Consumers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../idempotent-event-handlers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Idempotent Event Handlers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../event-versioning-and-evolution/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Event Versioning and Evolution
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../command-idempotency/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Command Idempotency
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../coordinating-long-running-processes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Coordinating Long-Running Processes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4" checked>
        
          
          <label class="md-nav__link" for="__nav_6_4" id="__nav_6_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Architecture & Quality
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Architecture & Quality
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../organize-by-domain-concept/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Organize by Domain Concept
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../validation-layering/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Validation Layering
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../thin-handlers-rich-domain/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Thin Handlers, Rich Domain
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Testing Domain Logic in Isolation
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Testing Domain Logic in Isolation
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      On this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-problem" class="md-nav__link">
    <span class="md-ellipsis">
      
        The Problem
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        The Pattern
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The Pattern">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#test-setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        Test Setup
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-aggregates" class="md-nav__link">
    <span class="md-ellipsis">
      
        Testing Aggregates
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Testing Aggregates">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-state-changes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Basic State Changes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#preconditions-and-business-rules" class="md-nav__link">
    <span class="md-ellipsis">
      
        Preconditions and Business Rules
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#domain-events" class="md-nav__link">
    <span class="md-ellipsis">
      
        Domain Events
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-value-objects" class="md-nav__link">
    <span class="md-ellipsis">
      
        Testing Value Objects
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Testing Value Objects">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#construction-and-validation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Construction and Validation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#equality" class="md-nav__link">
    <span class="md-ellipsis">
      
        Equality
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#operations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Operations
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#immutability" class="md-nav__link">
    <span class="md-ellipsis">
      
        Immutability
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-invariants" class="md-nav__link">
    <span class="md-ellipsis">
      
        Testing Invariants
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Testing Invariants">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#post-invariants" class="md-nav__link">
    <span class="md-ellipsis">
      
        Post-Invariants
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pre-invariants" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pre-Invariants
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-domain-services" class="md-nav__link">
    <span class="md-ellipsis">
      
        Testing Domain Services
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-entities-within-aggregates" class="md-nav__link">
    <span class="md-ellipsis">
      
        Testing Entities Within Aggregates
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#when-integration-tests-are-needed" class="md-nav__link">
    <span class="md-ellipsis">
      
        When Integration Tests Are Needed
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="When Integration Tests Are Needed">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#repository-integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Repository Integration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handler-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      
        Handler Pipeline
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#event-handler-integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Event Handler Integration
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-testing-pyramid" class="md-nav__link">
    <span class="md-ellipsis">
      
        The Testing Pyramid
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Summary
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_5" >
        
          
          <label class="md-nav__link" for="__nav_6_5" id="__nav_6_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Identity & Communication
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Identity & Communication
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../creating-identities-early/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Creating Identities Early
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../connect-concepts-across-domains/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Connecting Concepts Across Bounded Contexts
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../consuming-events-from-other-domains/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Consuming Events from Other Domains
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sharing-event-classes-across-domains/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Sharing Event Classes Across Domains
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_6" >
        
          
          <label class="md-nav__link" for="__nav_6_6" id="__nav_6_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Testing & Infrastructure
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Testing & Infrastructure
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dual-mode-testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dual-Mode Testing with Memory and Real Adapters
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../setting-up-and-tearing-down-database-for-tests/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Setting Up and Tearing Down Databases for Tests
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../running-migration-with-priority-lanes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Running Migrations Without Blocking Production
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../glossary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Glossary
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../community/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Community
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_8" id="__nav_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Community
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../community/quality/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quality Report
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../community/contributing/setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Setting up Protean locally
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../community/contributing/testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Testing Protean
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../community/contributing/adapters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Building Adapters
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      On this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-problem" class="md-nav__link">
    <span class="md-ellipsis">
      
        The Problem
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        The Pattern
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The Pattern">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#test-setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        Test Setup
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-aggregates" class="md-nav__link">
    <span class="md-ellipsis">
      
        Testing Aggregates
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Testing Aggregates">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-state-changes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Basic State Changes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#preconditions-and-business-rules" class="md-nav__link">
    <span class="md-ellipsis">
      
        Preconditions and Business Rules
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#domain-events" class="md-nav__link">
    <span class="md-ellipsis">
      
        Domain Events
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-value-objects" class="md-nav__link">
    <span class="md-ellipsis">
      
        Testing Value Objects
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Testing Value Objects">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#construction-and-validation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Construction and Validation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#equality" class="md-nav__link">
    <span class="md-ellipsis">
      
        Equality
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#operations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Operations
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#immutability" class="md-nav__link">
    <span class="md-ellipsis">
      
        Immutability
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-invariants" class="md-nav__link">
    <span class="md-ellipsis">
      
        Testing Invariants
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Testing Invariants">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#post-invariants" class="md-nav__link">
    <span class="md-ellipsis">
      
        Post-Invariants
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pre-invariants" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pre-Invariants
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-domain-services" class="md-nav__link">
    <span class="md-ellipsis">
      
        Testing Domain Services
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-entities-within-aggregates" class="md-nav__link">
    <span class="md-ellipsis">
      
        Testing Entities Within Aggregates
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#when-integration-tests-are-needed" class="md-nav__link">
    <span class="md-ellipsis">
      
        When Integration Tests Are Needed
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="When Integration Tests Are Needed">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#repository-integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Repository Integration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handler-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      
        Handler Pipeline
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#event-handler-integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Event Handler Integration
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-testing-pyramid" class="md-nav__link">
    <span class="md-ellipsis">
      
        The Testing Pyramid
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Summary
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
                




  <nav class="md-path" aria-label="Navigation" >
    <ol class="md-path__list">
      
      
        
  
  
    
    
      <li class="md-path__item">
        <a href="../" class="md-path__link">
          
  <span class="md-ellipsis">
    Patterns & Recipes
  </span>

        </a>
      </li>
    
  

      
        
  
  
    
    
      <li class="md-path__item">
        <a href="../organize-by-domain-concept/" class="md-path__link">
          
  <span class="md-ellipsis">
    Architecture & Quality
  </span>

        </a>
      </li>
    
  

      
    </ol>
  </nav>

              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="testing-domain-logic-in-isolation">Testing Domain Logic in Isolation</h1>
<h2 id="the-problem">The Problem</h2>
<p>A developer writes tests for an order placement feature:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TestPlaceOrder</span><span class="p">:</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_place_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_domain</span><span class="p">):</span>
        <span class="n">test_domain</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Order</span><span class="p">)</span>
        <span class="n">test_domain</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">OrderItem</span><span class="p">,</span> <span class="n">part_of</span><span class="o">=</span><span class="n">Order</span><span class="p">)</span>
        <span class="n">test_domain</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">PlaceOrder</span><span class="p">,</span> <span class="n">part_of</span><span class="o">=</span><span class="n">Order</span><span class="p">)</span>
        <span class="n">test_domain</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">OrderCommandHandler</span><span class="p">,</span> <span class="n">part_of</span><span class="o">=</span><span class="n">Order</span><span class="p">)</span>
        <span class="n">test_domain</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">OrderPlaced</span><span class="p">,</span> <span class="n">part_of</span><span class="o">=</span><span class="n">Order</span><span class="p">)</span>
        <span class="n">test_domain</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">traverse</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">test_domain</span><span class="o">.</span><span class="n">domain_context</span><span class="p">():</span>
            <span class="n">command</span> <span class="o">=</span> <span class="n">PlaceOrder</span><span class="p">(</span>
                <span class="n">order_id</span><span class="o">=</span><span class="s2">&quot;ord-123&quot;</span><span class="p">,</span>
                <span class="n">customer_id</span><span class="o">=</span><span class="s2">&quot;cust-456&quot;</span><span class="p">,</span>
                <span class="n">items</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;product_id&quot;</span><span class="p">:</span> <span class="s2">&quot;p-1&quot;</span><span class="p">,</span> <span class="s2">&quot;quantity&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;unit_price&quot;</span><span class="p">:</span> <span class="mf">10.0</span><span class="p">}],</span>
                <span class="n">total</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">test_domain</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

            <span class="n">repo</span> <span class="o">=</span> <span class="n">test_domain</span><span class="o">.</span><span class="n">repository_for</span><span class="p">(</span><span class="n">Order</span><span class="p">)</span>
            <span class="n">order</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ord-123&quot;</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">order</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;placed&quot;</span>
            <span class="k">assert</span> <span class="n">order</span><span class="o">.</span><span class="n">total</span> <span class="o">==</span> <span class="mf">20.0</span>
</code></pre></div>
<p>This test works, but it tests the entire pipeline: command deserialization,
handler dispatch, repository operations, and aggregate behavior -- all in one
test. When it fails, which part broke? The test doesn't tell you. It requires
registering multiple domain elements, initializing the domain, and managing
a domain context. It's slow relative to a unit test and tests more than it
intends to.</p>
<p>The deeper problem: when tests can only exercise business logic through the
handler pipeline, developers write fewer tests. The setup overhead discourages
testing edge cases, boundary conditions, and specific business rules. The domain
model -- the most important part of the system -- ends up being the least
tested.</p>
<hr />
<h2 id="the-pattern">The Pattern</h2>
<p>Test domain logic <strong>directly on domain objects</strong> -- aggregates, value objects,
entities, and domain services -- without handlers, repositories, commands, or
infrastructure. These are <strong>unit tests</strong> that exercise business rules in
isolation.</p>
<div class="highlight"><pre><span></span><code>Integration test (whole pipeline):
  Command  Handler  Repository  Aggregate  Event  Database
  (tests the plumbing)

Unit test (domain in isolation):
  Aggregate  call method  assert state
  (tests the business logic)
</code></pre></div>
<p>Both types of tests are valuable. But domain unit tests should be the
<strong>majority</strong> of your test suite because they test the most important code
(business rules) with the least overhead (no infrastructure).</p>
<h3 id="test-setup">Test Setup</h3>
<p>The examples below assume a <code>conftest.py</code> that uses Protean's <code>DomainFixture</code>
to initialize the domain and provide a per-test context:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># tests/conftest.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">protean.integrations.pytest</span><span class="w"> </span><span class="kn">import</span> <span class="n">DomainFixture</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">myapp</span><span class="w"> </span><span class="kn">import</span> <span class="n">domain</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s2">&quot;session&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">app_fixture</span><span class="p">():</span>
    <span class="n">domain</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;event_processing&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;sync&quot;</span>
    <span class="n">domain</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;command_processing&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;sync&quot;</span>

    <span class="n">fixture</span> <span class="o">=</span> <span class="n">DomainFixture</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>
    <span class="n">fixture</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
    <span class="k">yield</span> <span class="n">fixture</span>
    <span class="n">fixture</span><span class="o">.</span><span class="n">teardown</span><span class="p">()</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">autouse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">_ctx</span><span class="p">(</span><span class="n">app_fixture</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">app_fixture</span><span class="o">.</span><span class="n">domain_context</span><span class="p">():</span>
        <span class="k">yield</span>
</code></pre></div>
<p>With this setup, every test runs within an active domain context and all
data is reset between tests automatically.</p>
<hr />
<h2 id="testing-aggregates">Testing Aggregates</h2>
<h3 id="basic-state-changes">Basic State Changes</h3>
<p>Test aggregate methods by constructing an aggregate, calling a method, and
asserting the resulting state:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TestOrderPlacement</span><span class="p">:</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_placing_a_draft_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_domain</span><span class="p">):</span>
        <span class="n">order</span> <span class="o">=</span> <span class="n">Order</span><span class="p">(</span>
            <span class="n">customer_id</span><span class="o">=</span><span class="s2">&quot;cust-123&quot;</span><span class="p">,</span>
            <span class="n">status</span><span class="o">=</span><span class="s2">&quot;draft&quot;</span><span class="p">,</span>
            <span class="n">total</span><span class="o">=</span><span class="mf">50.0</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">order</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">OrderItem</span><span class="p">(</span>
            <span class="n">product_id</span><span class="o">=</span><span class="s2">&quot;prod-1&quot;</span><span class="p">,</span>
            <span class="n">quantity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">unit_price</span><span class="o">=</span><span class="mf">25.0</span><span class="p">,</span>
        <span class="p">))</span>

        <span class="n">order</span><span class="o">.</span><span class="n">place</span><span class="p">()</span>

        <span class="k">assert</span> <span class="n">order</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;placed&quot;</span>
        <span class="k">assert</span> <span class="n">order</span><span class="o">.</span><span class="n">placed_at</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_placing_an_already_placed_order_fails</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_domain</span><span class="p">):</span>
        <span class="n">order</span> <span class="o">=</span> <span class="n">Order</span><span class="p">(</span>
            <span class="n">customer_id</span><span class="o">=</span><span class="s2">&quot;cust-123&quot;</span><span class="p">,</span>
            <span class="n">status</span><span class="o">=</span><span class="s2">&quot;placed&quot;</span><span class="p">,</span>
            <span class="n">total</span><span class="o">=</span><span class="mf">50.0</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">)</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">order</span><span class="o">.</span><span class="n">place</span><span class="p">()</span>

        <span class="k">assert</span> <span class="s2">&quot;Only draft orders can be placed&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">order</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;placed&quot;</span>  <span class="c1"># State unchanged</span>
</code></pre></div>
<p>No repository, no handler, no command. Just the aggregate and its behavior.</p>
<h3 id="preconditions-and-business-rules">Preconditions and Business Rules</h3>
<p>Each business rule gets its own test:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TestAccountWithdrawal</span><span class="p">:</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_successful_withdrawal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_domain</span><span class="p">):</span>
        <span class="n">account</span> <span class="o">=</span> <span class="n">Account</span><span class="p">(</span><span class="n">balance</span><span class="o">=</span><span class="mf">1000.0</span><span class="p">,</span> <span class="n">overdraft_limit</span><span class="o">=</span><span class="mf">50.0</span><span class="p">)</span>

        <span class="n">account</span><span class="o">.</span><span class="n">withdraw</span><span class="p">(</span><span class="mf">200.0</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">account</span><span class="o">.</span><span class="n">balance</span> <span class="o">==</span> <span class="mf">800.0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_withdrawal_respects_overdraft_limit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_domain</span><span class="p">):</span>
        <span class="n">account</span> <span class="o">=</span> <span class="n">Account</span><span class="p">(</span><span class="n">balance</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span> <span class="n">overdraft_limit</span><span class="o">=</span><span class="mf">50.0</span><span class="p">)</span>

        <span class="c1"># Can withdraw up to balance + overdraft</span>
        <span class="n">account</span><span class="o">.</span><span class="n">withdraw</span><span class="p">(</span><span class="mf">150.0</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">account</span><span class="o">.</span><span class="n">balance</span> <span class="o">==</span> <span class="o">-</span><span class="mf">50.0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_withdrawal_exceeding_overdraft_fails</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_domain</span><span class="p">):</span>
        <span class="n">account</span> <span class="o">=</span> <span class="n">Account</span><span class="p">(</span><span class="n">balance</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span> <span class="n">overdraft_limit</span><span class="o">=</span><span class="mf">50.0</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">)</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">account</span><span class="o">.</span><span class="n">withdraw</span><span class="p">(</span><span class="mf">200.0</span><span class="p">)</span>

        <span class="k">assert</span> <span class="s2">&quot;Insufficient funds&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">account</span><span class="o">.</span><span class="n">balance</span> <span class="o">==</span> <span class="mf">100.0</span>  <span class="c1"># State unchanged</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_negative_withdrawal_fails</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_domain</span><span class="p">):</span>
        <span class="n">account</span> <span class="o">=</span> <span class="n">Account</span><span class="p">(</span><span class="n">balance</span><span class="o">=</span><span class="mf">1000.0</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">)</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">account</span><span class="o">.</span><span class="n">withdraw</span><span class="p">(</span><span class="o">-</span><span class="mf">50.0</span><span class="p">)</span>

        <span class="k">assert</span> <span class="s2">&quot;must be positive&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_withdrawal_from_frozen_account_fails</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_domain</span><span class="p">):</span>
        <span class="n">account</span> <span class="o">=</span> <span class="n">Account</span><span class="p">(</span><span class="n">balance</span><span class="o">=</span><span class="mf">1000.0</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s2">&quot;frozen&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">)</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">account</span><span class="o">.</span><span class="n">withdraw</span><span class="p">(</span><span class="mf">100.0</span><span class="p">)</span>

        <span class="k">assert</span> <span class="s2">&quot;non-active account&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</code></pre></div>
<p>Five tests, each targeting a specific business rule. Each runs in
milliseconds. Together, they comprehensively test the withdrawal behavior.</p>
<h3 id="domain-events">Domain Events</h3>
<p>Verify that aggregate methods raise the correct events:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TestOrderEvents</span><span class="p">:</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_placing_order_raises_order_placed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_domain</span><span class="p">):</span>
        <span class="n">order</span> <span class="o">=</span> <span class="n">Order</span><span class="p">(</span>
            <span class="n">customer_id</span><span class="o">=</span><span class="s2">&quot;cust-123&quot;</span><span class="p">,</span>
            <span class="n">total</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">order</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">OrderItem</span><span class="p">(</span>
            <span class="n">product_id</span><span class="o">=</span><span class="s2">&quot;prod-1&quot;</span><span class="p">,</span>
            <span class="n">quantity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">unit_price</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span>
        <span class="p">))</span>

        <span class="n">order</span><span class="o">.</span><span class="n">place</span><span class="p">()</span>

        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">_events</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">order</span><span class="o">.</span><span class="n">_events</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">OrderPlaced</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">event</span><span class="o">.</span><span class="n">order_id</span> <span class="o">==</span> <span class="n">order</span><span class="o">.</span><span class="n">order_id</span>
        <span class="k">assert</span> <span class="n">event</span><span class="o">.</span><span class="n">customer_id</span> <span class="o">==</span> <span class="s2">&quot;cust-123&quot;</span>
        <span class="k">assert</span> <span class="n">event</span><span class="o">.</span><span class="n">total</span> <span class="o">==</span> <span class="mf">100.0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_cancelling_shipped_order_raises_shipment_intercept</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_domain</span><span class="p">):</span>
        <span class="n">order</span> <span class="o">=</span> <span class="n">Order</span><span class="p">(</span>
            <span class="n">customer_id</span><span class="o">=</span><span class="s2">&quot;cust-123&quot;</span><span class="p">,</span>
            <span class="n">status</span><span class="o">=</span><span class="s2">&quot;shipped&quot;</span><span class="p">,</span>
            <span class="n">tracking_number</span><span class="o">=</span><span class="s2">&quot;TRK-789&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">order</span><span class="o">.</span><span class="n">cancel</span><span class="p">(</span><span class="s2">&quot;Customer changed mind&quot;</span><span class="p">)</span>

        <span class="n">events</span> <span class="o">=</span> <span class="n">order</span><span class="o">.</span><span class="n">_events</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">events</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">events</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">OrderCancelled</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">events</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ShipmentInterceptRequested</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">events</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tracking_number</span> <span class="o">==</span> <span class="s2">&quot;TRK-789&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_no_event_raised_when_operation_fails</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_domain</span><span class="p">):</span>
        <span class="n">order</span> <span class="o">=</span> <span class="n">Order</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="s2">&quot;draft&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">):</span>
            <span class="n">order</span><span class="o">.</span><span class="n">ship</span><span class="p">(</span><span class="s2">&quot;TRK-123&quot;</span><span class="p">)</span>

        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">_events</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>  <span class="c1"># No events on failure</span>
</code></pre></div>
<p>The <code>_events</code> list on the aggregate collects events raised via <code>raise_()</code>.
This allows direct inspection without infrastructure.</p>
<hr />
<h2 id="testing-value-objects">Testing Value Objects</h2>
<h3 id="construction-and-validation">Construction and Validation</h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TestMoney</span><span class="p">:</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_valid_money</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_domain</span><span class="p">):</span>
        <span class="n">money</span> <span class="o">=</span> <span class="n">Money</span><span class="p">(</span><span class="n">amount</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span> <span class="n">currency</span><span class="o">=</span><span class="s2">&quot;USD&quot;</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">money</span><span class="o">.</span><span class="n">amount</span> <span class="o">==</span> <span class="mf">100.0</span>
        <span class="k">assert</span> <span class="n">money</span><span class="o">.</span><span class="n">currency</span> <span class="o">==</span> <span class="s2">&quot;USD&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_negative_amount_rejected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_domain</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">)</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">Money</span><span class="p">(</span><span class="n">amount</span><span class="o">=-</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">currency</span><span class="o">=</span><span class="s2">&quot;USD&quot;</span><span class="p">)</span>

        <span class="k">assert</span> <span class="s2">&quot;cannot be negative&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_invalid_currency_rejected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_domain</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">)</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">Money</span><span class="p">(</span><span class="n">amount</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">currency</span><span class="o">=</span><span class="s2">&quot;XYZ&quot;</span><span class="p">)</span>

        <span class="k">assert</span> <span class="s2">&quot;Invalid currency&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_zero_amount_allowed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_domain</span><span class="p">):</span>
        <span class="n">money</span> <span class="o">=</span> <span class="n">Money</span><span class="p">(</span><span class="n">amount</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">currency</span><span class="o">=</span><span class="s2">&quot;USD&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">money</span><span class="o">.</span><span class="n">amount</span> <span class="o">==</span> <span class="mf">0.0</span>
</code></pre></div>
<h3 id="equality">Equality</h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TestMoneyEquality</span><span class="p">:</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_same_values_are_equal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_domain</span><span class="p">):</span>
        <span class="n">money1</span> <span class="o">=</span> <span class="n">Money</span><span class="p">(</span><span class="n">amount</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span> <span class="n">currency</span><span class="o">=</span><span class="s2">&quot;USD&quot;</span><span class="p">)</span>
        <span class="n">money2</span> <span class="o">=</span> <span class="n">Money</span><span class="p">(</span><span class="n">amount</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span> <span class="n">currency</span><span class="o">=</span><span class="s2">&quot;USD&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">money1</span> <span class="o">==</span> <span class="n">money2</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_different_amounts_are_not_equal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_domain</span><span class="p">):</span>
        <span class="n">money1</span> <span class="o">=</span> <span class="n">Money</span><span class="p">(</span><span class="n">amount</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span> <span class="n">currency</span><span class="o">=</span><span class="s2">&quot;USD&quot;</span><span class="p">)</span>
        <span class="n">money2</span> <span class="o">=</span> <span class="n">Money</span><span class="p">(</span><span class="n">amount</span><span class="o">=</span><span class="mf">200.0</span><span class="p">,</span> <span class="n">currency</span><span class="o">=</span><span class="s2">&quot;USD&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">money1</span> <span class="o">!=</span> <span class="n">money2</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_different_currencies_are_not_equal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_domain</span><span class="p">):</span>
        <span class="n">money1</span> <span class="o">=</span> <span class="n">Money</span><span class="p">(</span><span class="n">amount</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span> <span class="n">currency</span><span class="o">=</span><span class="s2">&quot;USD&quot;</span><span class="p">)</span>
        <span class="n">money2</span> <span class="o">=</span> <span class="n">Money</span><span class="p">(</span><span class="n">amount</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span> <span class="n">currency</span><span class="o">=</span><span class="s2">&quot;EUR&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">money1</span> <span class="o">!=</span> <span class="n">money2</span>
</code></pre></div>
<h3 id="operations">Operations</h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TestMoneyOperations</span><span class="p">:</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_adding_same_currency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_domain</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">Money</span><span class="p">(</span><span class="n">amount</span><span class="o">=</span><span class="mf">30.0</span><span class="p">,</span> <span class="n">currency</span><span class="o">=</span><span class="s2">&quot;USD&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
            <span class="n">Money</span><span class="p">(</span><span class="n">amount</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span> <span class="n">currency</span><span class="o">=</span><span class="s2">&quot;USD&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="n">Money</span><span class="p">(</span><span class="n">amount</span><span class="o">=</span><span class="mf">50.0</span><span class="p">,</span> <span class="n">currency</span><span class="o">=</span><span class="s2">&quot;USD&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_adding_different_currencies_fails</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_domain</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">)</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">Money</span><span class="p">(</span><span class="n">amount</span><span class="o">=</span><span class="mf">30.0</span><span class="p">,</span> <span class="n">currency</span><span class="o">=</span><span class="s2">&quot;USD&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
                <span class="n">Money</span><span class="p">(</span><span class="n">amount</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span> <span class="n">currency</span><span class="o">=</span><span class="s2">&quot;EUR&quot;</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">assert</span> <span class="s2">&quot;Cannot add different currencies&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">TestDateRange</span><span class="p">:</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_contains_date</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_domain</span><span class="p">):</span>
        <span class="n">range_</span> <span class="o">=</span> <span class="n">DateRange</span><span class="p">(</span>
            <span class="n">start_date</span><span class="o">=</span><span class="n">date</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">end_date</span><span class="o">=</span><span class="n">date</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="k">assert</span> <span class="n">range_</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">date</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span> <span class="ow">is</span> <span class="kc">True</span>
        <span class="k">assert</span> <span class="n">range_</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">date</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="ow">is</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_overlapping_ranges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_domain</span><span class="p">):</span>
        <span class="n">range1</span> <span class="o">=</span> <span class="n">DateRange</span><span class="p">(</span><span class="n">start_date</span><span class="o">=</span><span class="n">date</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">end_date</span><span class="o">=</span><span class="n">date</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span>
        <span class="n">range2</span> <span class="o">=</span> <span class="n">DateRange</span><span class="p">(</span><span class="n">start_date</span><span class="o">=</span><span class="n">date</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">end_date</span><span class="o">=</span><span class="n">date</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">))</span>
        <span class="k">assert</span> <span class="n">range1</span><span class="o">.</span><span class="n">overlaps</span><span class="p">(</span><span class="n">range2</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_non_overlapping_ranges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_domain</span><span class="p">):</span>
        <span class="n">range1</span> <span class="o">=</span> <span class="n">DateRange</span><span class="p">(</span><span class="n">start_date</span><span class="o">=</span><span class="n">date</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">end_date</span><span class="o">=</span><span class="n">date</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">31</span><span class="p">))</span>
        <span class="n">range2</span> <span class="o">=</span> <span class="n">DateRange</span><span class="p">(</span><span class="n">start_date</span><span class="o">=</span><span class="n">date</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">end_date</span><span class="o">=</span><span class="n">date</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">))</span>
        <span class="k">assert</span> <span class="n">range1</span><span class="o">.</span><span class="n">overlaps</span><span class="p">(</span><span class="n">range2</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span>
</code></pre></div>
<h3 id="immutability">Immutability</h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TestValueObjectImmutability</span><span class="p">:</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_value_object_is_immutable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_domain</span><span class="p">):</span>
        <span class="n">email</span> <span class="o">=</span> <span class="n">Email</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="s2">&quot;user@example.com&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">IncorrectUsageError</span><span class="p">):</span>
            <span class="n">email</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="s2">&quot;other@example.com&quot;</span>
</code></pre></div>
<hr />
<h2 id="testing-invariants">Testing Invariants</h2>
<h3 id="post-invariants">Post-Invariants</h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TestOrderInvariants</span><span class="p">:</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_order_must_have_items_when_placed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_domain</span><span class="p">):</span>
        <span class="n">order</span> <span class="o">=</span> <span class="n">Order</span><span class="p">(</span>
            <span class="n">customer_id</span><span class="o">=</span><span class="s2">&quot;cust-123&quot;</span><span class="p">,</span>
            <span class="n">status</span><span class="o">=</span><span class="s2">&quot;placed&quot;</span><span class="p">,</span>
            <span class="n">total</span><span class="o">=</span><span class="mf">50.0</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># No items added -- invariant should fire</span>

        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">)</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="c1"># Trigger invariant check by modifying the aggregate</span>
            <span class="n">order</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;placed&quot;</span>

        <span class="k">assert</span> <span class="s2">&quot;must have at least one item&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_discount_cannot_exceed_total</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_domain</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">)</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">Order</span><span class="p">(</span>
                <span class="n">customer_id</span><span class="o">=</span><span class="s2">&quot;cust-123&quot;</span><span class="p">,</span>
                <span class="n">total</span><span class="o">=</span><span class="mf">50.0</span><span class="p">,</span>
                <span class="n">discount</span><span class="o">=</span><span class="mf">75.0</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">assert</span> <span class="s2">&quot;Discount cannot exceed&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</code></pre></div>
<h3 id="pre-invariants">Pre-Invariants</h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TestAccountInvariants</span><span class="p">:</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_balance_must_be_above_overdraft_limit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_domain</span><span class="p">):</span>
        <span class="n">account</span> <span class="o">=</span> <span class="n">Account</span><span class="p">(</span><span class="n">balance</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span> <span class="n">overdraft_limit</span><span class="o">=</span><span class="mf">50.0</span><span class="p">)</span>

        <span class="c1"># This should fail the invariant</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">)</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">account</span><span class="o">.</span><span class="n">balance</span> <span class="o">=</span> <span class="o">-</span><span class="mf">100.0</span>  <span class="c1"># Below -50 overdraft limit</span>

        <span class="k">assert</span> <span class="s2">&quot;below overdraft limit&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</code></pre></div>
<hr />
<h2 id="testing-domain-services">Testing Domain Services</h2>
<p>Domain services coordinate logic across aggregates. Test them by passing in
aggregate instances directly:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TestTransferService</span><span class="p">:</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_valid_transfer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_domain</span><span class="p">):</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">Account</span><span class="p">(</span><span class="n">balance</span><span class="o">=</span><span class="mf">1000.0</span><span class="p">,</span> <span class="n">risk_score</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">policy</span> <span class="o">=</span> <span class="n">CreditPolicy</span><span class="p">(</span><span class="n">max_transfer_amount</span><span class="o">=</span><span class="mf">5000.0</span><span class="p">,</span> <span class="n">max_risk_score</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="n">TransferService</span><span class="o">.</span><span class="n">validate_and_debit</span><span class="p">(</span>
            <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span>
            <span class="n">policy</span><span class="o">=</span><span class="n">policy</span><span class="p">,</span>
            <span class="n">amount</span><span class="o">=</span><span class="mf">500.0</span><span class="p">,</span>
            <span class="n">transfer_id</span><span class="o">=</span><span class="s2">&quot;txn-1&quot;</span><span class="p">,</span>
            <span class="n">target_account_id</span><span class="o">=</span><span class="s2">&quot;acc-2&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">assert</span> <span class="n">source</span><span class="o">.</span><span class="n">balance</span> <span class="o">==</span> <span class="mf">500.0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_transfer_exceeding_policy_limit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_domain</span><span class="p">):</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">Account</span><span class="p">(</span><span class="n">balance</span><span class="o">=</span><span class="mf">10000.0</span><span class="p">,</span> <span class="n">risk_score</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">policy</span> <span class="o">=</span> <span class="n">CreditPolicy</span><span class="p">(</span><span class="n">max_transfer_amount</span><span class="o">=</span><span class="mf">5000.0</span><span class="p">,</span> <span class="n">max_risk_score</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">)</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">TransferService</span><span class="o">.</span><span class="n">validate_and_debit</span><span class="p">(</span>
                <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span>
                <span class="n">policy</span><span class="o">=</span><span class="n">policy</span><span class="p">,</span>
                <span class="n">amount</span><span class="o">=</span><span class="mf">7000.0</span><span class="p">,</span>
                <span class="n">transfer_id</span><span class="o">=</span><span class="s2">&quot;txn-1&quot;</span><span class="p">,</span>
                <span class="n">target_account_id</span><span class="o">=</span><span class="s2">&quot;acc-2&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">assert</span> <span class="s2">&quot;Exceeds policy limit&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">source</span><span class="o">.</span><span class="n">balance</span> <span class="o">==</span> <span class="mf">10000.0</span>  <span class="c1"># Not debited</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_transfer_with_high_risk_score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_domain</span><span class="p">):</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">Account</span><span class="p">(</span><span class="n">balance</span><span class="o">=</span><span class="mf">1000.0</span><span class="p">,</span> <span class="n">risk_score</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
        <span class="n">policy</span> <span class="o">=</span> <span class="n">CreditPolicy</span><span class="p">(</span><span class="n">max_transfer_amount</span><span class="o">=</span><span class="mf">5000.0</span><span class="p">,</span> <span class="n">max_risk_score</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">)</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">TransferService</span><span class="o">.</span><span class="n">validate_and_debit</span><span class="p">(</span>
                <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span>
                <span class="n">policy</span><span class="o">=</span><span class="n">policy</span><span class="p">,</span>
                <span class="n">amount</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span>
                <span class="n">transfer_id</span><span class="o">=</span><span class="s2">&quot;txn-1&quot;</span><span class="p">,</span>
                <span class="n">target_account_id</span><span class="o">=</span><span class="s2">&quot;acc-2&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">assert</span> <span class="s2">&quot;risk score exceeds&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</code></pre></div>
<p>No repositories, no handlers. Construct the aggregates, pass them to the
service, assert results.</p>
<hr />
<h2 id="testing-entities-within-aggregates">Testing Entities Within Aggregates</h2>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TestOrderItems</span><span class="p">:</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_adding_items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_domain</span><span class="p">):</span>
        <span class="n">order</span> <span class="o">=</span> <span class="n">Order</span><span class="p">(</span><span class="n">customer_id</span><span class="o">=</span><span class="s2">&quot;cust-123&quot;</span><span class="p">)</span>

        <span class="n">order</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span>
            <span class="n">product_id</span><span class="o">=</span><span class="s2">&quot;prod-1&quot;</span><span class="p">,</span>
            <span class="n">product_name</span><span class="o">=</span><span class="s2">&quot;Widget&quot;</span><span class="p">,</span>
            <span class="n">quantity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">unit_price</span><span class="o">=</span><span class="mf">15.0</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">items</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="k">assert</span> <span class="n">order</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">product_id</span> <span class="o">==</span> <span class="s2">&quot;prod-1&quot;</span>
        <span class="k">assert</span> <span class="n">order</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">quantity</span> <span class="o">==</span> <span class="mi">2</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_removing_items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_domain</span><span class="p">):</span>
        <span class="n">order</span> <span class="o">=</span> <span class="n">Order</span><span class="p">(</span><span class="n">customer_id</span><span class="o">=</span><span class="s2">&quot;cust-123&quot;</span><span class="p">)</span>
        <span class="n">order</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span>
            <span class="n">product_id</span><span class="o">=</span><span class="s2">&quot;prod-1&quot;</span><span class="p">,</span>
            <span class="n">product_name</span><span class="o">=</span><span class="s2">&quot;Widget&quot;</span><span class="p">,</span>
            <span class="n">quantity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">unit_price</span><span class="o">=</span><span class="mf">15.0</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">order</span><span class="o">.</span><span class="n">remove_item</span><span class="p">(</span><span class="s2">&quot;prod-1&quot;</span><span class="p">)</span>

        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">items</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_updating_item_quantity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_domain</span><span class="p">):</span>
        <span class="n">order</span> <span class="o">=</span> <span class="n">Order</span><span class="p">(</span><span class="n">customer_id</span><span class="o">=</span><span class="s2">&quot;cust-123&quot;</span><span class="p">)</span>
        <span class="n">order</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span>
            <span class="n">product_id</span><span class="o">=</span><span class="s2">&quot;prod-1&quot;</span><span class="p">,</span>
            <span class="n">product_name</span><span class="o">=</span><span class="s2">&quot;Widget&quot;</span><span class="p">,</span>
            <span class="n">quantity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">unit_price</span><span class="o">=</span><span class="mf">15.0</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">order</span><span class="o">.</span><span class="n">update_item_quantity</span><span class="p">(</span><span class="s2">&quot;prod-1&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">order</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">quantity</span> <span class="o">==</span> <span class="mi">5</span>
</code></pre></div>
<p>Entities are tested through their parent aggregate, which is how they're
accessed in production.</p>
<hr />
<h2 id="when-integration-tests-are-needed">When Integration Tests Are Needed</h2>
<p>Domain unit tests don't replace integration tests. They complement them.
Integration tests verify that the pipeline works end-to-end:</p>
<h3 id="repository-integration">Repository Integration</h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TestOrderPersistence</span><span class="p">:</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_order_round_trips_through_repository</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_domain</span><span class="p">):</span>
        <span class="n">test_domain</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Order</span><span class="p">)</span>
        <span class="n">test_domain</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">traverse</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">test_domain</span><span class="o">.</span><span class="n">domain_context</span><span class="p">():</span>
            <span class="n">repo</span> <span class="o">=</span> <span class="n">test_domain</span><span class="o">.</span><span class="n">repository_for</span><span class="p">(</span><span class="n">Order</span><span class="p">)</span>

            <span class="n">order</span> <span class="o">=</span> <span class="n">Order</span><span class="p">(</span>
                <span class="n">customer_id</span><span class="o">=</span><span class="s2">&quot;cust-123&quot;</span><span class="p">,</span>
                <span class="n">total</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span>
                <span class="n">status</span><span class="o">=</span><span class="s2">&quot;placed&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">repo</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>

            <span class="n">retrieved</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">order_id</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">retrieved</span><span class="o">.</span><span class="n">customer_id</span> <span class="o">==</span> <span class="s2">&quot;cust-123&quot;</span>
            <span class="k">assert</span> <span class="n">retrieved</span><span class="o">.</span><span class="n">total</span> <span class="o">==</span> <span class="mf">100.0</span>
            <span class="k">assert</span> <span class="n">retrieved</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;placed&quot;</span>
</code></pre></div>
<h3 id="handler-pipeline">Handler Pipeline</h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TestOrderCommandHandlerIntegration</span><span class="p">:</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_place_order_through_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_domain</span><span class="p">):</span>
        <span class="c1"># Register all elements needed for the pipeline</span>
        <span class="n">test_domain</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Order</span><span class="p">)</span>
        <span class="n">test_domain</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">PlaceOrder</span><span class="p">,</span> <span class="n">part_of</span><span class="o">=</span><span class="n">Order</span><span class="p">)</span>
        <span class="n">test_domain</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">OrderCommandHandler</span><span class="p">,</span> <span class="n">part_of</span><span class="o">=</span><span class="n">Order</span><span class="p">)</span>
        <span class="n">test_domain</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">traverse</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">test_domain</span><span class="o">.</span><span class="n">domain_context</span><span class="p">():</span>
            <span class="n">test_domain</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">PlaceOrder</span><span class="p">(</span>
                <span class="n">order_id</span><span class="o">=</span><span class="s2">&quot;ord-123&quot;</span><span class="p">,</span>
                <span class="n">customer_id</span><span class="o">=</span><span class="s2">&quot;cust-456&quot;</span><span class="p">,</span>
                <span class="n">items</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;product_id&quot;</span><span class="p">:</span> <span class="s2">&quot;p-1&quot;</span><span class="p">,</span> <span class="s2">&quot;quantity&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;unit_price&quot;</span><span class="p">:</span> <span class="mf">50.0</span><span class="p">}],</span>
                <span class="n">total</span><span class="o">=</span><span class="mf">50.0</span><span class="p">,</span>
            <span class="p">))</span>

            <span class="n">order</span> <span class="o">=</span> <span class="n">test_domain</span><span class="o">.</span><span class="n">repository_for</span><span class="p">(</span><span class="n">Order</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ord-123&quot;</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">order</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;placed&quot;</span>
</code></pre></div>
<h3 id="event-handler-integration">Event Handler Integration</h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TestInventoryReservationIntegration</span><span class="p">:</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_order_placed_triggers_reservation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_domain</span><span class="p">):</span>
        <span class="c1"># Register all elements for the event flow</span>
        <span class="n">test_domain</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Order</span><span class="p">)</span>
        <span class="n">test_domain</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Inventory</span><span class="p">)</span>
        <span class="n">test_domain</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">OrderPlaced</span><span class="p">,</span> <span class="n">part_of</span><span class="o">=</span><span class="n">Order</span><span class="p">)</span>
        <span class="n">test_domain</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">InventoryEventHandler</span><span class="p">,</span> <span class="n">part_of</span><span class="o">=</span><span class="n">Inventory</span><span class="p">)</span>
        <span class="n">test_domain</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">traverse</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">test_domain</span><span class="o">.</span><span class="n">domain_context</span><span class="p">():</span>
            <span class="c1"># Set up inventory</span>
            <span class="n">inventory_repo</span> <span class="o">=</span> <span class="n">test_domain</span><span class="o">.</span><span class="n">repository_for</span><span class="p">(</span><span class="n">Inventory</span><span class="p">)</span>
            <span class="n">inventory</span> <span class="o">=</span> <span class="n">Inventory</span><span class="p">(</span><span class="n">product_id</span><span class="o">=</span><span class="s2">&quot;prod-1&quot;</span><span class="p">,</span> <span class="n">available_quantity</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
            <span class="n">inventory_repo</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">inventory</span><span class="p">)</span>

            <span class="c1"># Simulate the event</span>
            <span class="n">event</span> <span class="o">=</span> <span class="n">OrderPlaced</span><span class="p">(</span>
                <span class="n">order_id</span><span class="o">=</span><span class="s2">&quot;ord-123&quot;</span><span class="p">,</span>
                <span class="n">customer_id</span><span class="o">=</span><span class="s2">&quot;cust-456&quot;</span><span class="p">,</span>
                <span class="n">items</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;product_id&quot;</span><span class="p">:</span> <span class="s2">&quot;prod-1&quot;</span><span class="p">,</span> <span class="s2">&quot;quantity&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">}],</span>
                <span class="n">total</span><span class="o">=</span><span class="mf">50.0</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">handler</span> <span class="o">=</span> <span class="n">InventoryEventHandler</span><span class="p">()</span>
            <span class="n">handler</span><span class="o">.</span><span class="n">on_order_placed</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

            <span class="n">updated</span> <span class="o">=</span> <span class="n">inventory_repo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;prod-1&quot;</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">updated</span><span class="o">.</span><span class="n">available_quantity</span> <span class="o">==</span> <span class="mi">95</span>
</code></pre></div>
<hr />
<h2 id="the-testing-pyramid">The Testing Pyramid</h2>
<div class="highlight"><pre><span></span><code>                    /\
                   /  \
                  / E2E \        Few: Full system with real databases
                 /--------\
                /Integration\    Some: Handler + repo + domain
               /--------------\
              /  Domain Unit    \ Many: Aggregates, VOs, services
             /____________________\
</code></pre></div>
<ul>
<li>
<p><strong>Domain unit tests (base):</strong> Fast, focused, comprehensive. Test every
  business rule, every edge case, every state transition. These are your
  primary tests.</p>
</li>
<li>
<p><strong>Integration tests (middle):</strong> Verify that the pipeline works. Test that
  commands flow through handlers, aggregates are persisted correctly, and
  events are delivered to handlers.</p>
</li>
<li>
<p><strong>End-to-end tests (top):</strong> Verify the full system with real databases
  and brokers. Test critical paths only -- these are slow and brittle.</p>
</li>
</ul>
<p>The domain unit tests should be the <strong>majority</strong> of your test suite because
they test the most important code with the least overhead.</p>
<hr />
<h2 id="summary">Summary</h2>
<table>
<thead>
<tr>
<th>Test Type</th>
<th>What It Tests</th>
<th>Setup Needed</th>
<th>Speed</th>
<th>Coverage Goal</th>
</tr>
</thead>
<tbody>
<tr>
<td>Domain unit</td>
<td>Business rules, invariants, state changes</td>
<td>Just the aggregate</td>
<td>Very fast</td>
<td>Comprehensive</td>
</tr>
<tr>
<td>Value object</td>
<td>Concept rules, equality, operations</td>
<td>Just the VO</td>
<td>Very fast</td>
<td>All validations</td>
</tr>
<tr>
<td>Domain service</td>
<td>Cross-aggregate coordination</td>
<td>Aggregates (no repos)</td>
<td>Very fast</td>
<td>All paths</td>
</tr>
<tr>
<td>Integration</td>
<td>Handler + repo pipeline</td>
<td>Domain registration</td>
<td>Medium</td>
<td>Critical paths</td>
</tr>
<tr>
<td>End-to-end</td>
<td>Full system behavior</td>
<td>Real infrastructure</td>
<td>Slow</td>
<td>Happy paths</td>
</tr>
</tbody>
</table>
<p>The principle: <strong>domain logic is the most important code in your system. Test
it directly, without infrastructure, in isolation. Construct aggregates, call
methods, assert results. Save integration tests for verifying the plumbing.</strong></p>
<div class="admonition tip">
<p class="admonition-title">Run all test layers in both modes</p>
<p>Domain unit tests already use in-memory adapters. Integration tests can
too -- with Protean's <a href="../dual-mode-testing/">Dual-Mode Testing</a>, a single
<code>pytest --protean-env memory</code> flag switches every adapter to its in-memory
equivalent. Run fast during development, then validate against real
infrastructure in CI.</p>
</div>
<hr />
<div class="admonition tip">
<p class="admonition-title">Related reading</p>
<p><strong>Concepts:</strong></p>
<ul>
<li><a href="../../concepts/building-blocks/aggregates/">Aggregates</a>  Aggregate structure and invariants.</li>
<li><a href="../../concepts/building-blocks/value-objects/">Value Objects</a>  Testing immutable domain concepts.</li>
</ul>
<p><strong>Guides:</strong></p>
<ul>
<li><a href="../../guides/testing/domain-model-tests/">Domain Model Tests</a>  Unit testing aggregates, entities, and value objects.</li>
<li><a href="../../guides/testing/fixtures-and-patterns/">Fixtures and Patterns</a>  Reusable pytest fixtures and test recipes.</li>
</ul>
</div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../thin-handlers-rich-domain/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Thin Handlers, Rich Domain">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Thin Handlers, Rich Domain
              </div>
            </div>
          </a>
        
        
          
          <a href="../creating-identities-early/" class="md-footer__link md-footer__link--next" aria-label="Next: Creating Identities Early">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Creating Identities Early
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2019 - 2026 Subhash Bhushan
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["content.code.annotate", "content.code.copy", "content.code.select", "content.tabs.link", "content.tooltips", "navigation.footer", "navigation.indexes", "navigation.sections", "navigation.expand", "navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.path", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.highlight", "search.suggest", "toc.follow"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../../assets/external/unpkg.com/mermaid@10/dist/mermaid.min.js"></script>
      
        <script src="../../javascripts/mermaid-init.js"></script>
      
    
  </body>
</html>